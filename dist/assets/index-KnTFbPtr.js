import*as i from"https://unpkg.com/three@0.160.1/build/three.module.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();const _=[9127187,10578751,12092762,16750592],p={X:50,Y:25,Z:50},V=3.2,Q={x:-20,y:V,z:20},he=.008,G=.5,g={wall:13158600,ceiling:16117990,floorDark:6111287,floorLight:9268835,bulb:16777164,wateringCan:2201331,cube:16750592,seed:0,switchPlate:16776960},be=[{hex:16777215,light:16777215},{hex:16777139,light:16773299},{hex:16757759,light:16738047},{hex:11796403,light:6750054}];function ge(e=null){const t=new i.Scene;t.background=new i.Color(1118481);const n=new i.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.5,1e3);e?(n.position.copy(e.cameraPosition),n.rotation.set(e.cameraRotation.x,e.cameraRotation.y,e.cameraRotation.z)):n.position.set(Q.x,Q.y,Q.z);const c=new i.WebGLRenderer({antialias:!0});c.setSize(window.innerWidth,window.innerHeight),c.domElement.style.touchAction="none",document.body.appendChild(c.domElement);const o=new i.AmbientLight(16777215,.05);t.add(o);const l=new i.SpotLight((e==null?void 0:e.spotLightColor)||16773299,e&&!e.isLampOn?0:9.5);l.position.set(0,p.Y,0),l.angle=Math.atan(28.6/p.Y),l.penumbra=.3,l.decay=1,l.distance=60,t.add(l);function u(d=128){const I=document.createElement("canvas");I.width=d,I.height=d;const C=I.getContext("2d");C.fillStyle="#C8C8C8",C.fillRect(0,0,d,d);const y=C.getImageData(0,0,d,d).data;for(let L=0;L<y.length;L+=4){let j=(Math.random()-.5)*15;Math.random()>.8&&(j*=2),y[L]=y[L+1]=y[L+2]=Math.min(255,Math.max(0,200+j)),y[L+3]=255}C.putImageData(new ImageData(y,d,d),0,0);const B=new i.CanvasTexture(I);return B.wrapS=B.wrapT=i.RepeatWrapping,B.repeat.set(6,6),B}const m=u();[{pos:[0,p.Y/2,-50/2],size:[p.X,p.Y,1],color:g.wall},{pos:[0,p.Y/2,p.Z/2],size:[p.X,p.Y,1],color:g.wall},{pos:[-50/2,p.Y/2,0],size:[1,p.Y,p.Z],color:g.wall},{pos:[p.X/2,p.Y/2,0],size:[1,p.Y,p.Z],color:g.wall},{pos:[0,0,0],size:[p.X,1,p.Z],color:g.wall},{pos:[0,p.Y,0],size:[p.X,1,p.Z],color:g.ceiling}].forEach((d,I)=>{const C=new i.BoxGeometry(...d.size),y=I<4?new i.MeshStandardMaterial({color:g.wall,map:m,roughness:.95,metalness:0,side:i.BackSide}):new i.MeshStandardMaterial({color:d.color,roughness:.9,metalness:0,side:i.BackSide}),B=new i.Mesh(C,y);B.position.set(...d.pos),t.add(B)});for(let d=0;d<p.X;d++)for(let I=0;I<p.Z;I++){const C=new i.MeshStandardMaterial({color:(d+I)%2===0?g.floorDark:g.floorLight,roughness:.95,metalness:0}),y=new i.Mesh(new i.PlaneGeometry(1,1),C);y.rotation.x=-Math.PI/2,y.position.set(-50/2+d+.5,.01,-50/2+I+.5),t.add(y)}const a=new i.Mesh(new i.SphereGeometry(2,16,16),new i.MeshBasicMaterial({color:(e==null?void 0:e.bulbColor)||g.bulb}));a.position.set(0,p.Y,0),t.add(a);const r=new i.Mesh(new i.CylinderGeometry(.4,.4,.8,16),new i.MeshStandardMaterial({color:g.wateringCan}));e?(r.position.copy(e.wateringCan.position),r.visible=e.wateringCan.visible):r.position.set(5,.5,0),t.add(r);const h=new i.Mesh(new i.BoxGeometry(1.5,1.5,1.5),new i.MeshStandardMaterial({color:g.cube}));h.position.set(1e3,0,0),h.visible=!1,h.userData={type:"cube",wet:!1,dryStage:3},t.add(h);const w=new i.Mesh(new i.SphereGeometry(.5,8,8),new i.MeshStandardMaterial({color:g.seed}));w.position.set(1e3,0,0),w.visible=!1,w.userData={type:"seed"},t.add(w);const E=new i.MeshStandardMaterial({color:g.switchPlate,emissive:3355392,side:i.DoubleSide}),v=new i.Mesh(new i.PlaneGeometry(.25,.25),E);v.position.set(0,V,-50/2+.51),v.rotation.y=Math.PI,t.add(v);const x=new i.Mesh(new i.BoxGeometry(1,.5,1),E);return x.position.set(0,V,p.Z/2-.51),t.add(x),{scene:t,camera:n,renderer:c,objects:{spotLight:l,bulb:a,wateringCan:r,originalCube:h,originalSeed:w,switchPlate:v,colorTile:x}}}function ie(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}let M={coins:100,heldObject:null,clones:new Set,isLampOn:!0,cubeUIVisible:!1,wateringCanUIVisible:!1,seedUIVisible:!1};const f=()=>M,we=()=>M.heldObject,J=()=>M.clones,A=e=>{M.coins=e},k=e=>{M.heldObject=e},se=e=>{M.clones.add(e)},xe=e=>{M.clones.delete(e)},Ie=()=>{M.isLampOn=!M.isLampOn},X=e=>{M.cubeUIVisible=e},Z=e=>{M.wateringCanUIVisible=e},F=e=>{M.seedUIVisible=e},Ce=document.getElementById("coinCount"),Me=document.getElementById("cubeUI"),Ee=document.getElementById("wateringCanUI"),ve=document.getElementById("seedUI"),K=document.getElementById("confirmBox"),Be=document.getElementById("confirmText"),ae=document.getElementById("confirmYes"),ce=document.getElementById("confirmNo"),Y=document.getElementById("colorPickerUI");let z=!1;function Oe(){Ce.textContent=f().coins}function N(){Me.style.display=f().cubeUIVisible?"block":"none",Ee.style.display=f().wateringCanUIVisible?"block":"none",ve.style.display=f().seedUIVisible?"block":"none"}function ee(e,t,n,c,o){z||(Be.textContent=e,ae.textContent=t,ce.textContent=n,ae.onclick=()=>{c(),K.style.display="none",z=!1},ce.onclick=()=>{o(),K.style.display="none",z=!1},K.style.display="block",z=!0)}function Le(e){Y.innerHTML="<p>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç</p>",be.forEach(t=>{const n=document.createElement("div");n.style.backgroundColor="#"+t.hex.toString(16).padStart(6,"0"),n.onclick=()=>{e(t),Y.style.display="none"},Y.appendChild(n)}),Y.style.display="block"}function ke(e,t,n,c){const{wateringCan:o,switchPlate:l,colorTile:u,originalCube:m,originalSeed:b}=n,a=document.querySelector("canvas");let r=null,h=null,w=!1;const E=x=>{r&&clearTimeout(r),r=null,h=null},v=(x,d)=>{r&&clearTimeout(r),h=x,r=setTimeout(()=>{d(),E()},200)};a.addEventListener("pointerdown",x=>{if(!document.getElementById("pauseMenu").style.display.includes("flex")&&!document.getElementById("shopMenu").style.display.includes("flex")&&!w){x.clientX,x.clientY;const d=new i.Raycaster,I=new i.Vector3(0,0,-1).applyQuaternion(e.quaternion);d.set(e.position,I);const C=5,y=[];J().forEach(P=>{if(P.visible){const T=d.intersectObject(P);T.length&&T[0].distance<=C&&y.push({obj:P,dist:T[0].distance})}});const B=d.intersectObject(o),L=d.intersectObject(l),j=d.intersectObject(u);if(B.length&&B[0].distance<=C&&y.push({obj:o,dist:B[0].distance}),L.length&&L[0].distance<=C&&y.push({obj:l,dist:L[0].distance}),j.length&&j[0].distance<=C&&y.push({obj:u,dist:j[0].distance}),y.length===0)return E();y.sort((P,T)=>P.dist-T.dist);const O=y[0].obj;h!==O&&E(),O===u?(w=!0,c("colorPicker")):O===l?(Ie(),c("lamp")):O===o&&f().heldObject!==o&&f().heldObject===null?v(O,()=>{k(o),o.visible=!1,c("pickup",o)}):J().has(O)&&f().heldObject!==O&&f().heldObject===null&&v(O,()=>{k(O),O.visible=!1,c("pickup",O)})}}),a.addEventListener("pointermove",E),a.addEventListener("pointerup",E),a.addEventListener("pointercancel",E)}const U=document.getElementById("shopContent");function le(e,t,n,c,o,l){U.innerHTML="",[{id:"cube",name:"–ö—É–±",icon:"üüß",price:10},{id:"seed",name:"–°–µ–º–µ—á–∫–æ",icon:"‚ö´",price:10}].forEach(m=>{const b=document.createElement("div");b.className="shopItem",b.innerHTML=`<div class="itemIcon">${m.icon}</div><div class="itemName">${m.name}<br/>${m.price} –º–æ–Ω–µ—Ç</div>`,b.onclick=()=>{ee(`–ö—É–ø–∏—Ç—å ${m.name} –∑–∞ ${m.price} –º–æ–Ω–µ—Ç?`,"–î–∞","–ù–µ—Ç",()=>{if(f().coins>=m.price){o();let a;m.id==="cube"?(a=n.clone(),a.material=n.material.clone(),a.userData={...n.userData,isClone:!0,cloneId:ie()}):(a=c.clone(),a.material=c.material.clone(),a.userData={...c.userData,isClone:!0,cloneId:ie()});const r=new THREE.Vector3(0,-.3,-1.2).applyQuaternion(t.quaternion);a.position.copy(t.position).add(r),a.visible=!0,e.add(a),l(a),k(a),A(f().coins-m.price)}else ee("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!","OK","",()=>{},()=>{})},()=>{})},U.appendChild(b)})}function De(e){U.innerHTML="";const t=we();if(!t||t==="wateringCan"||!J().has(t)){U.innerHTML='<div style="color:#aaa;">–ù–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏</div>';return}const n=t.userData.type==="cube"?"–ö—É–±":"–°–µ–º–µ—á–∫–æ",c=document.createElement("div");c.className="shopItem",c.innerHTML=`<div class="itemIcon">${t.userData.type==="cube"?"üüß":"‚ö´"}</div><div class="itemName">${n}<br/>10 –º–æ–Ω–µ—Ç</div>`,c.onclick=()=>{ee(`–ü—Ä–æ–¥–∞—Ç—å ${n} –∑–∞ 10 –º–æ–Ω–µ—Ç?`,"–î–∞","–ù–µ—Ç",()=>{e(t),A(f().coins+10)},()=>{})},U.appendChild(c)}function je(e,t,n,c,o,l,u,m){const{coins:b,heldObject:a,cubeUIVisible:r,wateringCanUIVisible:h,seedUIVisible:w,isLampOn:E}=getState(),v=[];m.forEach(d=>{d.userData.type==="cube"?v.push({type:"cube",position:d.position.clone(),wet:d.userData.wet,dryStage:d.userData.dryStage,color:d.material.color.getHex(),cloneId:d.userData.cloneId}):d.userData.type==="seed"&&v.push({type:"seed",position:d.position.clone(),cloneId:d.userData.cloneId})});let x=null;return a&&(a===o?x="wateringCan":m.has(a)&&(x=a.userData.cloneId)),{cameraPosition:t.position.clone(),cameraRotation:{x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},isLampOn:E,spotLightColor:n.color.getHex(),bulbColor:c.material.color.getHex(),wateringCan:{position:o.position.clone(),visible:o.visible},clones:v,heldObjectId:x,cubeUIVisible:r,wateringCanUIVisible:h,seedUIVisible:w,coins:b}}function Se(e,t,n,c,o,l,u,m,b){return n.position.copy(e.cameraPosition),n.rotation.set(e.cameraRotation.x,e.cameraRotation.y,e.cameraRotation.z),c.intensity=e.isLampOn?9.5:0,c.color.setHex(e.spotLightColor),o.material.color.setHex(e.bulbColor),l.position.copy(e.wateringCan.position),l.visible=e.wateringCan.visible,e.clones.forEach(a=>{let r;a.type==="cube"?(r=u.clone(),r.material=u.material.clone(),r.position.copy(a.position),r.userData={type:"cube",wet:a.wet,dryStage:a.dryStage,cloneId:a.cloneId,isClone:!0},r.material.color.setHex(a.color),t.add(r),b.add(r),a.wet&&a.dryStage<3&&setTimeout(()=>{let h=a.dryStage+1;const w=()=>{if(h>=_.length){r.userData.wet=!1,r.userData.dryStage=3;return}r.userData.dryStage=h,r.material.color.set(_[h]),h<_.length-1?r.userData.dryTimer=setTimeout(()=>{h++,w()},1e4):r.userData.wet=!1};w()},100)):a.type==="seed"&&(r=m.clone(),r.material=m.material.clone(),r.position.copy(a.position),r.userData={type:"seed",cloneId:a.cloneId,isClone:!0},t.add(r),b.add(r))}),e.heldObjectId}const ne=document.getElementById("mainMenu"),H=document.getElementById("continueBtn"),Pe=document.getElementById("playBtn"),Te=document.getElementById("exitBtn"),q=document.getElementById("pauseBtn"),W=document.getElementById("shopBtn"),oe=document.getElementById("pauseMenu"),re=document.getElementById("shopMenu"),Ue=document.getElementById("resumeBtn"),He=document.getElementById("saveAndExitBtn"),Ye=document.getElementById("backToMenuBtn"),ze=document.getElementById("shopBuyBtn"),Re=document.getElementById("shopSellBtn"),Ve=document.getElementById("shopCloseBtn"),Ge=document.getElementById("debug");let D=!1,$=!1,s=null,R=0,pe=0,Ae={x:0},S={w:!1,a:!1,s:!1,d:!1},fe=/Android|iPhone|iPad/i.test(navigator.userAgent);function me(e=null){if($)return;const{scene:t,camera:n,renderer:c,objects:o}=ge(e);if(s={scene:t,camera:n,renderer:c,objects:o},e){A(e.coins);const l=Se(e,t,n,o.spotLight,o.bulb,o.wateringCan,o.originalCube,o.originalSeed,f().clones);l==="wateringCan"?(k(o.wateringCan),Z(!0)):l&&f().clones.forEach(u=>{u.userData.cloneId===l&&(k(u),u.userData.type==="cube"?X(!0):u.userData.type==="seed"&&F(!0))})}else A(100);Oe(),N(),ke(n,t,o,$e),ze.onclick=()=>le(t,n,o.originalCube,o.originalSeed,de,se),Re.onclick=()=>De(Xe),Ve.onclick=()=>{re.style.display="none",D=!0},W.onclick=()=>{D=!1,re.style.display="flex",le(t,n,o.originalCube,o.originalSeed,de,se)},te(0),$=!0}function $e(e,t){e==="lamp"?s.objects.spotLight.intensity=f().isLampOn?9.5:0:e==="colorPicker"?Le(n=>{s.objects.spotLight.color.set(n.light),s.objects.bulb.material.color.set(n.hex)}):e==="pickup"&&(k(t),t===s.objects.wateringCan?Z(!0):t.userData.type==="cube"?X(!0):t.userData.type==="seed"&&F(!0),N())}function de(){const e=f().heldObject;if(!e||!s)return;const t=new i.Vector3(0,0,-2).applyQuaternion(s.camera.quaternion);let n=s.camera.position.clone().add(t);n.y=e===s.objects.wateringCan?.5:e.userData.type==="cube"?1.5/2:.5,n.x=Math.round(n.x),n.z=Math.round(n.z);const c=p.X/2-G,o=p.Z/2-G;n.x=Math.max(-c,Math.min(c,n.x)),n.z=Math.max(-o,Math.min(o,n.z)),e.position.copy(n),e.visible=!0,k(null),X(!1),Z(!1),F(!1),N()}function Xe(e){s.scene.remove(e),xe(e),k(null),X(!1),Z(!1),F(!1),N()}function Ze(e){let t=0,n=0;fe?(t=-0,n=Ae.x):(S.w&&(t+=1),S.s&&(t-=1),S.a&&(n-=1),S.d&&(n+=1));const c=Math.hypot(t,n);if(c>0){t/=c,n/=c;const m=he*Math.pow(c,.4)*e,b=new i.Vector3(-Math.sin(R),0,-Math.cos(R)).normalize(),a=new i.Vector3().crossVectors(b,new i.Vector3(0,1,0)).normalize();s.camera.position.x+=(b.x*t+a.x*n)*m,s.camera.position.z+=(b.z*t+a.z*n)*m}s.camera.position.y=V;const o=p.X/2-G,l=p.Z/2-G;if(s.camera.position.x=Math.max(-o,Math.min(o,s.camera.position.x)),s.camera.position.z=Math.max(-l,Math.min(l,s.camera.position.z)),s.camera.rotation.order="YXZ",s.camera.rotation.y=R,s.camera.rotation.x=pe,f().heldObject){const u=new i.Vector3(0,-.3,-1.2).applyQuaternion(s.camera.quaternion);f().heldObject.position.copy(s.camera.position).add(u),f().heldObject.quaternion.copy(s.camera.quaternion),f().heldObject.rotateY(Math.PI)}f().clones.forEach(u=>{u.visible&&u.userData.type==="cube"?u.position.y=1.5/2:u.visible&&u.userData.type==="seed"&&(u.position.y=.5)}),s.objects.wateringCan.visible&&(s.objects.wateringCan.position.y=.5)}let ue=0;function te(e){if(!D||!s)return requestAnimationFrame(te);const t=e-ue;ue=e,Ze(t);const n=s.camera.position,c=(R*180/Math.PI).toFixed(1),o=(pe*180/Math.PI).toFixed(1);Ge.textContent=`POS: X=${n.x.toFixed(1)}, Y=${n.y.toFixed(1)}, Z=${n.z.toFixed(1)}
LOOK: Yaw=${c}¬∞, Pitch=${o}¬∞
MOBILE: ${fe?"–î–∞":"–ù–µ—Ç"} | FPS: ${Math.round(1e3/t)}`,s.renderer.render(s.scene,s.camera),requestAnimationFrame(te)}window.addEventListener("keydown",e=>{S[e.key.toLowerCase()]=["w","a","s","d"].includes(e.key.toLowerCase())});window.addEventListener("keyup",e=>{S[e.key.toLowerCase()]=!1});Pe.onclick=()=>{ne.style.display="none",q.style.display="block",W.style.display="block",D=!0,me(null)};H.onclick=()=>{const e=localStorage.getItem("savedGameState");e&&(ne.style.display="none",q.style.display="block",W.style.display="block",D=!0,me(JSON.parse(e)))};Te.onclick=()=>{confirm("–í—ã–π—Ç–∏?")&&location.reload()};q.onclick=()=>{D=!1,oe.style.display="flex"};Ue.onclick=()=>{oe.style.display="none",D=!0};He.onclick=()=>{if($&&s){const e=je(s.scene,s.camera,s.objects.spotLight,s.objects.bulb,s.objects.wateringCan,s.objects.originalCube,s.objects.originalSeed,f().clones);localStorage.setItem("savedGameState",JSON.stringify(e)),H.style.display="block"}ye()};Ye.onclick=()=>{localStorage.removeItem("savedGameState"),H.style.display="none",ye()};function ye(){oe.style.display="none",ne.style.display="block",q.style.display="none",W.style.display="none",D=!1,$=!1,document.querySelectorAll("#cubeUI, #wateringCanUI, #seedUI, #colorPickerUI, #confirmBox, #shopMenu").forEach(e=>e.style.display="none")}localStorage.getItem("savedGameState")?H.style.display="block":H.style.display="none";window.addEventListener("resize",()=>{s&&(s.camera.aspect=window.innerWidth/window.innerHeight,s.camera.updateProjectionMatrix(),s.renderer.setSize(window.innerWidth,window.innerHeight))});
